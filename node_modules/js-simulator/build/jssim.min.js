var jssim=jssim||{};!function(t){t.exchange=function(t,i,e){var s=t[i];t[i]=t[e],t[e]=s},t.shuffle=function(i){for(var e=i.length,s=1;s<e;++s){var h=Math.floor(Math.random()*(1+s));t.exchange(i,s,h)}},t.s4=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},t.guid=function(){return t.s4()+t.s4()+"-"+t.s4()+"-"+t.s4()+"-"+t.s4()+"-"+t.s4()+t.s4()+t.s4()};var i=function(t){t||(t=function(t,i){return t-i}),this.s=[],this.N=0,this.compare=t};i.prototype.less=function(t,i){return this.compare(t,i)<0},i.prototype.enqueue=function(t){for(;this.s.length<=this.N+1;)this.s.push(0);this.s[++this.N]=t,this.swim(this.N)},i.prototype.delMin=function(){if(0==this.N)return null;var i=this.s[1];return t.exchange(this.s,1,this.N--),this.sink(1),i},i.prototype.min=function(){return 0==this.N?null:this.s[1]},i.prototype.sink=function(i){for(;2*i<=this.N;){var e=2*i;if(e<this.N&&this.less(this.s[e+1],this.s[e])&&e++,!this.less(this.s[e],this.s[i]))break;t.exchange(this.s,e,i),i=e}},i.prototype.swim=function(i){for(;i>1;){var e=Math.floor(i/2);if(!this.less(this.s[i],this.s[e]))break;t.exchange(this.s,i,e),i=e}},i.prototype.clear=function(){this.s=[],this.N=0},i.prototype.size=function(){return this.N},i.prototype.isEmpty=function(){return 0==this.N},t.MinPQ=i;var e=function(t){this.value=t,this.next=null};t.StackNode=e;var s=function(){this.N=0,this.first=null};s.prototype.push=function(i){var e=this.first;this.first=new t.StackNode(i),this.first.next=e,this.N++},s.prototype.pop=function(t){var i=this.first;if(null==i)return null;var t=i.value;return this.first=i.next,this.N--,t},s.prototype.clear=function(){this.N=0,this.first=null},s.prototype.size=function(){return this.N},s.prototype.isEmpty=function(){return 0==this.N},t.Stack=s;var h=function(t){this.value=t,this.next=null};t.QueueNode=h;var n=function(){this.first=null,this.last=null,this.N=0};n.prototype.enqueue=function(i){var e=this.last;this.last=new t.QueueNode(i),null!=e&&(e.next=this.last),null==this.first&&(this.first=this.last),this.N++},n.prototype.dequeue=function(){var t=this.first;if(null==t)return null;var i=t.value;return this.first=t.next,null==this.first&&(this.last=null),this.N--,i},n.prototype.clear=function(){this.first=null,this.last=null,this.N=0},n.prototype.isEmpty=function(){return 0==this.N},n.prototype.size=function(){return this.N},t.Queue=n;var r=function(t){this.time=0,this.rank=t||1};r.prototype.guid=function(){return this.id?this.id:(this.id=t.guid(),this.id)},r.prototype.sendMsg=function(t,i){this.scheduler.messenger.sendMsg(this.guid(),t,i)},r.prototype.readInBox=function(){return this.scheduler.messenger.readInBox(this.guid())},t.SimEvent=r;var o=function(){this.pq=new t.MinPQ(function(t,i){var e=t.time-i.time;return 0==e?i.rank-t.rank:e}),this.current_time=null,this.current_rank=null,this.messenger=new t.Messenger(this)};o.prototype.update=function(){for(var t=null;!this.pq.isEmpty();){var i=this.pq.min(),e=i.time;i.rank;if(null==t)t=e;else if(t!=e)break;this.update_mini()}this.messenger.update(0)},o.prototype.update_mini=function(){for(var i=null,e=null,s=[];!this.pq.isEmpty();){var h=this.pq.min(),n=h.time,r=h.rank;if(null==i)i=n;else if(i!=n)break;if(null==e)e=r;else if(e!=r)break;s.push(this.pq.delMin())}t.shuffle(s);var o=this.current_time;s.length>0&&(this.current_time=i,this.current_rank=e);for(a=0;a<s.length;++a){var l=0;l=null!=this.current_time?i-o:i,s[a].update?s[a].update(l):console.log("event does not define update(deltaTime) method!!!")}for(var a=0;a<s.length;++a)s[a].repeatInterval&&this.scheduleRepeatingAt(s[a],this.current_time+s[a].repeatInterval,s[a].repeatInterval);return s},o.prototype.schedule=function(t,i){t.time=i,t.scheduler||(t.scheduler=this),this.pq.enqueue(t)},o.prototype.hasEvents=function(){return!this.pq.isEmpty()},o.prototype.scheduleOnceIn=function(t,i){var e=this.current_time;null==this.current_time&&(e=0),t.scheduler||(t.scheduler=this),t.time=e+i,this.pq.enqueue(t)},o.prototype.scheduleRepeatingIn=function(t,i){var e=this.current_time;null==this.current_time&&(e=0),t.scheduler||(t.scheduler=this),this.scheduleRepeatingAt(t,e+i,i)},o.prototype.scheduleRepeatingAt=function(t,i,e){t.time=i,t.repeatInterval=e,t.scheduler||(t.scheduler=this),this.pq.enqueue(t)},o.prototype.reset=function(){this.current_rank=null,this.current_time=null,this.pq.clear(),this.messenger.reset()},t.Scheduler=o;var l=function(t,i){this.x=t,this.y=i};l.prototype.distance=function(t){var i=this.x-t.x,e=this.y-t.y;return Math.sqrt(i*i+e*e)},l.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},l.prototype.resize=function(t){var i=this.length();if(0!=i){var e=t/i;this.x*=e,this.y*=e}},l.prototype.addIn=function(t){this.x+=t.x,this.y+=t.y},l.prototype.set=function(t,i){this.x=t,this.y=i},t.Vector2D=l;var a=function(t,i,e,s){this.x1=t,this.y1=i,this.x2=e,this.y2=s};t.Line2D=a;var u=function(){this.locations=[],this.agents=[],this.width=100,this.height=100,this.lines=[],this.cellWidth=1,this.cellHeight=1,this.network=null};u.prototype.reset=function(){this.locations=[],this.agents=[],this.lines=[],null!=this.network&&this.network.reset()},u.prototype.getLocation=function(t){return this.locations[t]},u.prototype.getAgent=function(t){return this.agents[t]},u.prototype.updateAgent=function(i,e,s){this.locations[i.id]=new t.Vector2D(e,s),this.agents[i.id]=i},u.prototype.findAllAgents=function(){return this.agents},u.prototype.drawLine=function(i,e,s,h){this.lines.push(new t.Line2D(i,e,s,h))},u.prototype.clearLines=function(){this.lines=[]},u.prototype.render=function(i){if(i){var e=i.getContext("2d");if(e.clearRect(0,0,i.width,i.height),null!=this.network){e.strokeStyle=this.network.lineColor;for(var s=0;s<this.network.V;++s){var h=this.network.adj(s);if(0!=h.length)for(var n=this.locations[s],r=n.x,o=n.y,l=0;l<h.length;++l){var a=h[l];if(a.either()==s){var u=a.other(s),c=this.locations[u],p=c.x,f=c.y;console.log(r+", "+o+" == "+d+g),d=p,g=f,e.moveTo(r*this.cellWidth,i.height-o*this.cellHeight),e.lineTo(p*this.cellWidth,i.height-f*this.cellHeight),e.stroke()}}}}e.strokeStyle="#0000FF";for(var d=0,g=0,l=0;l<this.lines.length;++l){e.beginPath();var y=this.lines[l],r=y.x1,o=y.y1,p=y.x2,f=y.y2;console.log(r+", "+o+" == "+d+g),d=p,g=f,e.moveTo(r*this.cellWidth,i.height-o*this.cellHeight),e.lineTo(p*this.cellWidth,i.height-f*this.cellHeight),e.stroke()}for(id in this.locations){var v=this.agents[id],m=this.locations[id];if(v.draw)v.draw(e,new t.Vector2D(m.x,i.height-m.y));else{e.fillStyle="#000000",v.color&&(e.fillStyle=v.color);var x=20,w=20;v.size&&(x=v.size.x,w=v.size.y),x||(x=20),w||(w=20),v.id&&(e.font="12 Arial",e.fillText(""+v.id,m.x,i.height-m.y)),e.fillRect(m.x,i.height-m.y,x,w)}}}},u.prototype.getNeighborsWithinDistance=function(t,i){var e=[];for(id in this.locations)this.locations[id].distance(t)<i&&e.push(this.agents[id]);return e},t.Space2D=u;var c=function(t,i){this.width=t,this.height=i,this.cells=[],this.trails=[],this.potentialField=[],this.obstacles=[],this.targets=[];for(var e=0;e<t;++e){this.cells.push([]),this.trails.push([]),this.obstacles.push([]),this.targets.push([]),this.potentialField.push([]);for(var s=0;s<i;++s)this.cells[e].push(0),this.trails[e].push(0),this.obstacles[e].push(0),this.targets[e].push(0),this.potentialField[e].push(0)}this.color="#ff0000",this.trailColor="#55aa55",this.obstacleColor="#888888",this.targetColor="#0000ff",this.cellWidth=10,this.cellHeight=10,this.showTrails=!1,this.showPotentialField=!1,this.maxPotential=-1e6,this.minPotential=1e6};c.prototype.setCell=function(t,i,e){this.cells[t][i]=e,e>0&&(this.trails[t][i]+=1)},c.prototype.setObstable=function(t,i,e){this.obstacles[t][i]=e},c.prototype.setPotential=function(t,i,e){this.potentialField[t][i]=e,e>this.maxPotential&&(this.maxPotential=e),e<this.minPotential&&(this.minPotential=e)},c.prototype.setTarget=function(t,i,e){this.targets[t][i]=e},c.prototype.createCylinder=function(t,i,e){var s=t-e,h=t+e,n=i-e,r=i+e;s<0&&(s=0),h>=this.width&&(h=this.width-1),n<0&&(n=0),r>=this.height&&(r=this.height-1);for(var o=s;o<=h;++o)for(var l=n;l<=r;++l){var a=o-t,u=l-i;Math.sqrt(a*a+u*u)<=e&&(this.obstacles[o][l]=1)}},c.prototype.createTarget=function(t,i,e){for(var s=Math.floor(e/2),h=t-s,n=h+e,r=i-s,o=r+e,l=h;l<=n;++l)for(var a=r;a<=o;++a)this.targets[l][a]=1},c.prototype.getCell=function(t,i){return this.cells[t][i]},c.prototype.makeCopy=function(){for(var t=new c(this.width,this.height),i=0;i<this.width;++i)for(var e=0;e<this.height;++e)t.cells[i][e]=this.cells[i][e],t.potentialField[i][e]=this.potentialField[i][e],t.obstacles[i][e]=this.obstacles[i][e],t.targets[i][e]=this.targets[i][e],t.trails[i][e]=this.trails[i][e];return t.showPotentialField=this.showPotentialField,t.showTrails=this.showTrails,t.minPotential=this.minPotential,t.maxPotential=this.maxPotential,t.cellWidth=this.cellWidth,t.cellHeight=this.cellHeight,t.color=this.color,t.trailColor=this.trailColor,t.targetColor=this.targetColor,t.obstacleColor=this.obstacleColor,t},c.prototype.reset=function(){for(var t=0;t<this.width;++t)for(var i=0;i<this.height;++i)this.cells[t][i]=0,this.trails[t][i]=0,this.obstacles[t][i]=0,this.targets[t][i]=0,this.potentialField[t][i]=0;this.maxPotential=-1e6,this.minPotential=1e6},c.prototype.isOccupied=function(t,i){return!(t<0||t>=this.width)&&(!(i<0||i>=this.height)&&this.cells[t][i]>0)},c.prototype.isObstacle=function(t,i){return!(t<0||t>=this.width)&&(!(i<0||i>=this.height)&&this.obstacles[t][i]>0)},c.prototype.isTarget=function(t,i){return!(t<0||t>=this.width)&&(!(i<0||i>=this.height)&&this.targets[t][i]>0)},c.prototype.render=function(t){if(t){var i=t.getContext("2d");i.clearRect(0,0,t.width,t.height),i.fillStyle=this.color;for(var e=0;e<this.width;++e)for(var s=0;s<this.height;++s){if(this.showTrails&&this.trails[e][s]>0&&(i.fillStyle=this.trailColor,i.fillRect(e*this.cellWidth,s*this.cellHeight,this.cellWidth-1,this.cellHeight-1)),this.showPotentialField&&0!=this.potentialField[e][s]){var h=this.potentialField[e][s],n=100+Math.floor(155*(h-this.minPotential)/(this.maxPotential-this.minPotential)),r=Math.floor(255*(h-this.minPotential)/(this.maxPotential-this.minPotential));i.fillStyle="rgb(255,"+n+","+r+")",i.fillRect(e*this.cellWidth,s*this.cellHeight,this.cellWidth-1,this.cellHeight-1)}this.obstacles[e][s]>0&&(i.fillStyle=this.obstacleColor,i.fillRect(e*this.cellWidth,s*this.cellHeight,this.cellWidth-1,this.cellHeight-1)),this.cells[e][s]>0&&(i.fillStyle=this.color,i.fillRect(e*this.cellWidth,s*this.cellHeight,this.cellWidth-1,this.cellHeight-1)),this.targets[e][s]>0&&(i.fillStyle=this.targetColor,i.fillRect(e*this.cellWidth,s*this.cellHeight,this.cellWidth-1,this.cellHeight-1))}}},t.Grid=c;var p=function(t,i,e){this.v=t,this.w=i,this.info=e};p.prototype.other=function(t){return t==this.v?this.w:this.v},p.prototype.either=function(){return this.v},t.Edge=p;var f=function(t){this.V=t,this.adjList=[];for(var i=0;i<t;++i)this.adjList.push([]);this.lineColor="#cccccc"};f.prototype.adj=function(t){return this.adjList[t]},f.prototype.reset=function(){this.adjList=[];for(var t=0;t<this.V;++t)this.adjList.push([])},f.prototype.addEdge=function(t){var i=t.either(),e=t.other(i);this.adjList[i].push(t),this.adjList[e].push(t)},f.prototype.connected=function(t,i){for(var e=this.adjList[t],s=0;s<e.length;++s)if((n=e[s]).other(t)==i)return!0;for(var h=this.adjList[i],s=0;s<h.length;++s){var n=h[s];if(n.other(i)==t)return!0}return!1},t.Network=f;var d=function(i){t.SimEvent(this,-1e9),this.inbox={},this.scheduler=i};(d.prototype=Object.create(t.SimEvent.prototype)).update=function(t){for(recipient in this.inbox){var i=this.inbox[recipient];if(i.size()>10)for(var e=i.min();null!=e&&e.time<this.scheduler.current_time&&(i.delMin(),!i.isEmpty());)e=i.min()}},d.prototype.sendMsg=function(i,e,s){s.recipient||(s.recipient=e),s.sender||(s.sender=i);var h=null;e in this.inbox?h=this.inbox[e]:(h=new t.MinPQ(function(t,i){var e=t.time-i.time;return 0==e?t.rank-i.rank:e}),this.inbox[e]=h),s.rank||(s.rank=1),s.time||(s.time=this.scheduler.current_time),h.enqueue(s)},d.prototype.reset=function(){this.inbox=[]},d.prototype.readInBox=function(i){var e=null;i in this.inbox?e=this.inbox[i]:(e=new t.MinPQ(function(t,i){var e=t.time-i.time;return 0==e?t.rank-i.rank:e}),this.inbox[i]=e);for(var s=e.min(),h=[];null!=s&&s.time<=this.scheduler.current_time&&(e.delMin(),h.push(s),!e.isEmpty());)s=e.min();return h},t.Messenger=d}(jssim);var module=module||{};module&&(module.exports=jssim);